<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>UK Tender Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background:#f5f5f5; }
    h1 { color:#333; text-align:center; }
    .tender-card { background:#fff; border-radius:8px; padding:20px; margin:15px 0; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    .tender-title { font-size:1.2em; font-weight:bold; color:#0066cc; margin-bottom:10px; }
    .tender-info { color:#666; margin:5px 0; }
    .loading { text-align:center; padding:50px; font-size:1.2em; color:#666; }
  </style>
</head>
<body>
  <h1>ðŸ‡¬ðŸ‡§ UK Government Tenders</h1>
  <div id="tenders-container"><div class="loading">Loading tenders...</div></div>

  <script>
    function fmtCurrency(amount) {
      if (amount == null || Number.isNaN(Number(amount))) return 'N/A';
      return new Intl.NumberFormat('en-GB', { style: 'currency', currency: 'GBP' }).format(Number(amount));
    }

    async function loadTenders() {
      try {
        const res = await fetch('tenders-data.json', { cache: 'no-store' });
        const json = await res.json();
        const items = (json.data && json.data.releases) || json.releases || [];

        const container = document.getElementById('tenders-container');
        container.innerHTML = '';
        if (!items || items.length === 0) {
          container.innerHTML = '<div class="loading">No tenders found</div>';
          return;
        }

        items.slice(0, 20).forEach(t => {
          const title = t.tender?.title || t.title || 'No title';
          const buyer = t.buyer?.name || (t.parties && t.parties[0]?.name) || 'N/A';
          const amount = t.tender?.value?.amount ?? t.value?.amount;
          const dateStr = t.date || t.tender?.date || t.ocid || '';
          const date = dateStr ? new Date(dateStr) : null;

          const card = document.createElement('div');
          card.className = 'tender-card';
          card.innerHTML = `
            <div class="tender-title">${title}</div>
            <div class="tender-info"><strong>Buyer:</strong> ${buyer}</div>
            <div class="tender-info"><strong>Value:</strong> ${fmtCurrency(amount)}</div>
            <div class="tender-info"><strong>Published:</strong> ${date ? date.toLocaleDateString() : 'N/A'}</div>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        document.getElementById('tenders-container').innerHTML =
          '<div class="loading">Error loading tenders. Data may not be available yet.</div>';
      }
    }
    loadTenders();
  </script>
</body>
</html>